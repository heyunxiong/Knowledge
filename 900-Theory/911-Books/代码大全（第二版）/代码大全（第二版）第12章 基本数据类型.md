# 第12章 基本数据类型

使用不同数据类型的时候，需要注意的事项总结。

## 12.1 数值概论
- 避免使用“Magic Number”，魔数！ 像直接使用100，200作为变量，应该用常量具名化。如MAX_NUMBER = 100。
- 预防除零错误 devide-by zero。每次使用除法符号/的时候，都要考虑表达式分母为0的情况。
- 使类型转换变得明显，即显式类型转换。y= x + (float) z;
- 避免混合类型的比较。比如 x 是浮点数， y是整数； if（x =y）{。。。} 这种情况不可控。编译器可能在临界值比较的时候可能会报错
- 注意编译器的警告 warning。

## 12.2 整数
- 检查整数除法。7/10不等于0.7；它总是等于0，或者等于负无穷大，或者等于最接近的整数。10*（7/10）=0
- 检查整数溢出。即考虑整数的范围
![](_assets/_file_代码大全（第二版）第12章%20基本数据类型/img-代码大全（第二版）第12章%20基本数据类型-20220717_224105406.png)
- 检查中间结果溢出。你需要关心的不仅是一个算式的最后数值。

## 12.3 浮点数
- 避免数量级相差巨大的数之间的加减运算。32位浮点变量，1000000.00 + 0.1可能会得到1000000.00，因为32位不能给你足够的有效位数包容1000000和0.1之间的数值区间。
- 避免等量判断。很多应该相等的浮点数值并不一定相等，10个0.1加起来不等于1.0。
```java
double nominal = 1.0;
double sum = 0.0;
for (int i; i < 10; i++){
	sum += 0.1;
}
if(nominal == sum ){ //结果是false
...
}else{
....
}
```
- 处理舍入误差问题。由于舍入误差，导致精度丢失，因此计算结果会有出入。可以使用更高精度解决

## 12.4 字符和字符串
- 避免神秘字符或神秘字符串。 如 region.equals("HK"); HK应该用常量具名化，REGION_HK = "HK"; region.equals(REGION_HK);
- 避免 off-by-one 错误。由于子字符串的下标索引方式几乎与数组的一样，因此要避免因为读写操作超出了字符串末尾而导致的off-by-one（偏差一）错误
- 最好支持Unicode，或者有处理Unicode字符的代码
- 国际化、本地化的功能
- 如果仅支持一种语言，可以考虑使用ISO8859字符集（但我感觉是UTF-8，比较稳妥）

## 12.5 布尔变量
- 用布尔变量对程序加以文档说明。 不同于仅仅判断一个布尔表达式，可以把这种表达式的结果赋给一个变脸，从而使得这一判断含义变得明显
```java
//含义不明确
if((elementIndex<0)||(MAX_ELEMENTS < elemntIndex)){
...
}
//含义清晰
finished = elementIndex<0;
ready = MAX_ELEMENTS < elemntIndex;
if((finished) || (ready)){
...
}
```
- 避免在if判断里面防止过多的布尔表达式，如果判断逻辑多或者复杂，可以通过简化每一步得到判断结果后，在放去if里面。如上例那样

## 12.6 枚举类型
- 用枚举类来提高可读性。if choseColor = 1; 使用枚举类后，if choseColor = Color_Red; 
- 用枚举类提高可靠性
- 用枚举类简化修改。枚举类使代码修改更容易
- 用枚举类作为布尔变量的替代方案。布尔变量往往无法充分表达它所需要表达的含义。
- 检查非法数值。else子句捕捉非法值
- 定义出枚举类的第一项和最后一项，便于循环边界
- 把枚举类的第一个元素留作非法值

## 12.7 具名常量
常量定义后，不能再修改。
- 使用具名常量 可以提高程序的可读性和可维护性 LOCAL_NUMBER_LENGTH = 7,  而不是直接用7
- 避免使用文字量，即时是安全的。for i=1 to 12 .... 12这里含义不清楚。 for i=1 to NUM_MONTHS_IN_YEAR
- 统一地使用具名变量

## 12.8 数组类型
一个数组中含有相同类型的元素，可通过数组下标访问元素。
- 避免数组越界
- 考虑容器代替数组，或者将数组作为顺序化结构来处理
- 检查数组的临界值
- 检查多维数组的下标顺序。a\[i]\[j] 和a\[j]\[i]

2022年7月17日
Yunxiong
